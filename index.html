<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F1 - Corrida 3D Aprimorada</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #202020;
  }
  canvas {
    display: block;
  }
  #controls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-around;
    pointer-events: none;
  }
  /* Estilo aprimorado para controles de toque */
  .btn {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    pointer-events: all;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: white;
    user-select: none;
    cursor: pointer;
  }
  #controls-vertical {
    position: fixed;
    bottom: 20px;
    left: 20px;
    display: flex;
    flex-direction: column;
    pointer-events: none;
  }
  .btn-v {
    margin-bottom: 10px;
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    pointer-events: all;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    color: white;
    user-select: none;
    cursor: pointer;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="controls">
  <div class="btn" id="left">⟵</div>
  <div class="btn" id="right">⟶</div>
</div>

<div id="controls-vertical">
    <div class="btn-v" id="up">⇧</div>
    <div class="btn-v" id="down">⇩</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Variáveis de Jogo
let speed = 0;              // Velocidade atual (agora começa em 0)
const maxSpeed = 15;        // Velocidade máxima
const minSpeed = 0;         // Velocidade mínima
let turn = 0;               // Ângulo de esterço
let roadOffset = 0;         // Deslocamento horizontal da pista (para virar)
let curve = 0;              // Posição na curva da pista
let roadZ = 0;              // Posição Z da estrada (para rolagem das linhas)

// Variáveis de Controle
let turningLeft = false;
let turningRight = false;
let accelerating = false;
let braking = false;

// Ajusta o tamanho do canvas
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas(); 

// --- Configuração de Controles ---

// Funções de Eventos para Touch e Mouse
const touchEvents = (id, flag, value) => {
    document.getElementById(id).addEventListener("touchstart", (e) => { e.preventDefault(); window[flag] = value; });
    document.getElementById(id).addEventListener("touchend", () => window[flag] = false);
    // Adiciona suporte a mouse down/up para desktop nos botões
    document.getElementById(id).addEventListener("mousedown", () => window[flag] = value);
    document.getElementById(id).addEventListener("mouseup", () => window[flag] = false);
};

// Controles de direção
touchEvents("left", "turningLeft", true);
touchEvents("right", "turningRight", true);

// Controles de velocidade
touchEvents("up", "accelerating", true);
touchEvents("down", "braking", true);

// Controles de Teclado
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") turningLeft = true;
  if (e.key === "ArrowRight") turningRight = true;
  if (e.key === "ArrowUp") accelerating = true;
  if (e.key === "ArrowDown") braking = true;
});

document.addEventListener("keyup", e => {
  if (e.key === "ArrowLeft") turningLeft = false;
  if (e.key === "ArrowRight") turningRight = false;
  if (e.key === "ArrowUp") accelerating = false;
  if (e.key === "ArrowDown") braking = false;
});

// --- Funções de Desenho ---

/**
 * Desenha a estrada com perspectiva 3D e efeito de movimento.
 */
function drawRoad() {
  const horizon = canvas.height / 2;
  
  // A cada iteração (frame), a posição Z da estrada avança pela velocidade.
  // Isso cria o efeito de rolagem da pista.
  roadZ = (roadZ + speed * 0.1) % 20;

  // Loop de baixo para cima (do mais perto para o mais longe)
  for (let y = 0; y < horizon; y++) {
    const perspective = y / horizon;
    
    // Cálculo da largura e posição central da pista
    const roadWidth = 2000 * (1 - perspective);
    const x = canvas.width / 2 + roadOffset * perspective;
    const left = x - roadWidth / 2;
    // const right = x + roadWidth / 2;

    // Define a cor alternada das linhas da pista para simular movimento
    // Usa 'roadZ' para deslocar as linhas de acordo com a velocidade
    const lineIndex = Math.floor((y + roadZ) / 20); // 20 é o espaçamento das linhas
    ctx.fillStyle = lineIndex % 2 === 0 ? "#111" : "#0a0a0a"; 
    
    // Desenha o segmento da pista
    ctx.fillRect(left, canvas.height - y, roadWidth, 2); 
    
    // Opcional: Desenha as linhas laterais (guard-rails)
    ctx.fillStyle = "white";
    ctx.fillRect(left - 10, canvas.height - y, 5, 2); // Borda Esquerda
    ctx.fillRect(left + roadWidth + 5, canvas.height - y, 5, 2); // Borda Direita
  }
}

/**
 * Desenha a HUD com a velocidade.
 */
function drawHUD() {
  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  // A velocidade é mapeada para algo mais realista
  ctx.fillText("Velocidade: " + Math.floor(speed * 25) + " km/h", 20, 40);
  ctx.fillText("Pista: " + (curve > 0 ? "Curva Dir." : curve < 0 ? "Curva Esq." : "Reta"), 20, 70);
}

/**
 * Desenha o carro.
 */
function drawCar() {
  ctx.fillStyle = "red";
  ctx.beginPath();
  // Base do carro
  ctx.moveTo(canvas.width / 2 - 40, canvas.height - 50);
  ctx.lineTo(canvas.width / 2 + 40, canvas.height - 50);
  // Frente do carro (o deslocamento do nariz pode simular a curva)
  const noseX = canvas.width / 2 + turn * 20; 
  ctx.lineTo(noseX, canvas.height - 120);
  ctx.closePath();
  ctx.fill();
  
  // Rodas (simplificadas)
  ctx.fillStyle = "#333";
  ctx.fillRect(canvas.width / 2 - 50, canvas.height - 60, 10, 20); // Roda Esquerda
  ctx.fillRect(canvas.width / 2 + 40, canvas.height - 60, 10, 20); // Roda Direita
}


// --- Lógica do Jogo ---

/**
 * Atualiza o estado do jogo.
 */
function update() {
  // 1. Controle de Velocidade
  if (accelerating) {
    speed = Math.min(speed + 0.1, maxSpeed);
  } else if (braking) {
    speed = Math.max(speed - 0.2, minSpeed);
  }
  // Fricção (Desaceleração natural)
  speed *= 0.99; 
  if (speed < 0.1) speed = 0;

  // 2. Controle de Direção (Esterço)
  if (turningLeft) turn -= 0.005;
  if (turningRight) turn += 0.005;
  
  // Restaura o esterço levemente ao soltar o controle
  turn *= 0.95;

  // 3. Simulação de Curvas da Pista
  // Faz a pista curvar suavemente ao longo do tempo (crescendo e decrescendo)
  curve = Math.sin(Date.now() * 0.0001) * 300; // Oscila entre -300 e 300
  
  // 4. Movimento da Estrada
  // roadOffset é a soma: 
  //   a) Ação do jogador (Math.sin(turn))
  //   b) Curva da pista (curve)
  roadOffset += (Math.sin(turn) * speed * 0.5) + (curve - roadOffset) * 0.005 * speed;
  
  // Limitador simples de RoadOffset (para não sair demais da tela)
  roadOffset = Math.max(-500, Math.min(500, roadOffset));
  
  // 5. Penalidade por Alta Velocidade na Curva (Exemplo de lógica de jogabilidade)
  if (Math.abs(curve) > 100 && speed > 10) {
      // Se estiver muito rápido em uma curva fechada, penaliza a direção
      roadOffset += Math.sign(roadOffset - curve) * (speed - 10) * 0.5;
  }
}

/**
 * O loop principal do jogo (Game Loop).
 */
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpa o canvas

  drawRoad();
  drawCar();
  drawHUD();
  
  update();

  requestAnimationFrame(loop);
}

// Inicia o jogo
loop();
</script>
</body>
</html>

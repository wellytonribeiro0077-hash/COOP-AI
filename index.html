<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mini Standoff 2 2D</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #222;
            font-family: Arial, sans-serif;
        }
        #game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        canvas {
            display: block;
            background: #444;
            width: 100%;
            height: auto;
            border: 2px solid #fff;
        }
        .joystick {
            position: absolute;
            bottom: 50px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            touch-action: manipulation;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .joystick-inner {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            position: absolute;
            transition: transform 0.1s;
        }
        #joystick-left { left: 50px; }
        #joystick-right { right: 50px; }
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            color: red;
            text-align: center;
            display: none;
        }
        @media (min-width: 801px) {
            .joystick {
                display: none; /* Hide joysticks on desktop */
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        <div class="joystick" id="joystick-left"><div class="joystick-inner" id="left-inner"></div></div>
        <div class="joystick" id="joystick-right"><div class="joystick-inner" id="right-inner"></div></div>
        <div class="game-over" id="gameOverText">
            Game Over<br>Pontos: <span id="finalScore">0</span>
        </div>
    </div>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // Adjust for high-DPI displays
        const scale = window.devicePixelRatio;
        canvas.style.width = "800px";
        canvas.style.height = "500px";
        canvas.width = 800 * scale;
        canvas.height = 500 * scale;
        ctx.scale(scale, scale);

        let player = { x: 400, y: 250, angle: 0, health: 100, lastShot: 0 };
        let bullets = [];
        let enemies = [
            { x: 100, y: 100, speed: 1, health: 50 },
            { x: 700, y: 400, speed: 1, health: 50 }
        ];
        let score = 0;
        let gameRunning = true;
        let lastTime = 0;
        let lastSpawn = 0;

        // Input handling
        let move = { x: 0, y: 0 };
        let shoot = { x: 0, y: 0 };
        const keys = { w: false, s: false, a: false, d: false, up: false, down: false, left: false, right: false };

        // Sound effects
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(frequency, duration) {
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            oscillator.connect(audioCtx.destination);
            oscillator.start();
            setTimeout(() => oscillator.stop(), duration);
        }
        function playShootSound() { playSound(800, 50); }
        function playHitSound() { playSound(400, 100); }
        function playGameOverSound() { playSound(200, 200); }

        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.angle);
            ctx.fillStyle = "#00FF00"; // Green body
            ctx.fillRect(-15, -10, 30, 20);
            ctx.fillStyle = "#FFD700"; // Yellow head
            ctx.beginPath();
            ctx.arc(10, 0, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = "#000"; // Eyes
            ctx.beginPath();
            ctx.arc(8, -4, 2, 0, Math.PI * 2);
            ctx.arc(8, 4, 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = "#888"; // Gun
            ctx.fillRect(15, -2, 10, 4);
            ctx.restore();
            // Health bar
            ctx.fillStyle = "#FF0000";
            ctx.fillRect(player.x - 20, player.y - 20, 40, 5);
            ctx.fillStyle = "#00FF00";
            ctx.fillRect(player.x - 20, player.y - 20, 40 * (player.health / 100), 5);
        }

        function drawBullets() {
            bullets.forEach(b => {
                ctx.fillStyle = "#FF0000";
                ctx.fillRect(b.x - 5, b.y - 5, 10, 10);
                ctx.strokeStyle = "#FFF";
                ctx.lineWidth = 1;
                ctx.strokeRect(b.x - 5, b.y - 5, 10, 10);
            });
        }

        function drawEnemies() {
            enemies.forEach(e => {
                ctx.fillStyle = "#800080"; // Purple body
                ctx.fillRect(e.x - 15, e.y - 15, 30, 30);
                ctx.fillStyle = "#000";
                ctx.beginPath();
                ctx.arc(e.x - 5, e.y - 5, 3, 0, Math.PI * 2);
                ctx.arc(e.x + 5, e.y - 5, 3, 0, Math.PI * 2);
                ctx.fill();
                // Health bar
                ctx.fillStyle = "#FF0000";
                ctx.fillRect(e.x - 15, e.y - 25, 30, 5);
                ctx.fillStyle = "#00FF00";
                ctx.fillRect(e.x - 15, e.y - 25, 30 * (e.health / 50), 5);
            });
        }

        function drawScore() {
            ctx.font = "20px Arial";
            ctx.fillStyle = "#FFF";
            ctx.fillText(`Pontos: ${score}`, 10, 30);
        }

        function update(deltaTime) {
            // Player movement
            let moveSpeed = 3 * deltaTime;
            if (keys.a || keys.d || keys.w || keys.s) {
                move.x = (keys.d ? 1 : 0) - (keys.a ? 1 : 0);
                move.y = (keys.s ? 1 : 0) - (keys.w ? 1 : 0);
                const mag = Math.sqrt(move.x * move.x + move.y * move.y);
                if (mag > 0) {
                    move.x /= mag;
                    move.y /= mag;
                }
            }
            player.x += move.x * moveSpeed;
            player.y += move.y * moveSpeed;

            // Screen bounds
            player.x = Math.max(15, Math.min(canvas.width - 15, player.x));
            player.y = Math.max(15, Math.min(canvas.height - 15, player.y));

            // Player aiming and shooting
            if (keys.left || keys.right || keys.up || keys.down) {
                shoot.x = (keys.right ? 1 : 0) - (keys.left ? 1 : 0);
                shoot.y = (keys.down ? 1 : 0) - (keys.up ? 1 : 0);
                const mag = Math.sqrt(shoot.x * shoot.x + shoot.y * shoot.y);
                if (mag > 0) {
                    shoot.x /= mag;
                    shoot.y /= mag;
                }
            }
            if (shoot.x !== 0 || shoot.y !== 0) {
                player.angle = Math.atan2(shoot.y, shoot.x);
                if (!player.lastShot || Date.now() - player.lastShot > 300) {
                    bullets.push({
                        x: player.x + Math.cos(player.angle) * 15,
                        y: player.y + Math.sin(player.angle) * 15,
                        vx: Math.cos(player.angle) * 5,
                        vy: Math.sin(player.angle) * 5
                    });
                    player.lastShot = Date.now();
                    playShootSound();
                }
            }

            // Update bullets
            bullets.forEach((b, i) => {
                b.x += b.vx * deltaTime;
                b.y += b.vy * deltaTime;
                if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
                    bullets.splice(i, 1);
                }
            });

            // Update enemies
            enemies.forEach((e, i) => {
                const dx = player.x - e.x;
                const dy = player.y - e.y;
                const mag = Math.sqrt(dx * dx + dy * dy);
                if (mag > 0) {
                    e.x += (dx / mag) * e.speed * deltaTime;
                    e.y += (dy / mag) * e.speed * deltaTime;
                }
                // Enemy collision with player
                if (Math.hypot(player.x - e.x, player.y - e.y) < 30) {
                    player.health -= 10 * deltaTime;
                    if (player.health <= 0) gameOver();
                }
                // Bullet collision with enemy
                bullets.forEach((b, j) => {
                    if (Math.hypot(b.x - e.x, b.y - e.y) < 20) {
                        e.health -= 10;
                        bullets.splice(j, 1);
                        if (e.health <= 0) {
                            enemies.splice(i, 1);
                            score += 100;
                            playHitSound();
                        }
                    }
                });
            });

            // Spawn new enemies
            if (Date.now() - lastSpawn > 5000 && enemies.length < 5) {
                const side = Math.floor(Math.random() * 4);
                let x, y;
                if (side === 0) { x = Math.random() * canvas.width; y = 0; }
                else if (side === 1) { x = Math.random() * canvas.width; y = canvas.height; }
                else if (side === 2) { x = 0; y = Math.random() * canvas.height; }
                else { x = canvas.width; y = Math.random() * canvas.height; }
                enemies.push({ x, y, speed: 1, health: 50 });
                lastSpawn = Date.now();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#444');
            gradient.addColorStop(1, '#222');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawEnemies();
            drawBullets();
            drawPlayer();
            drawScore();
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverText').style.display = 'block';
            playGameOverSound();
        }

        function gameLoop(time) {
            if (!gameRunning) return;
            const deltaTime = (time - lastTime) / 16.67; // Normalize to 60fps
            lastTime = time;

            update(deltaTime);
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Joystick handling
        function joystick(id, callback) {
            const stick = document.getElementById(id);
            const inner = document.getElementById(id + '-inner');
            let rect = stick.getBoundingClientRect();
            let center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
            let active = false;

            stick.addEventListener("touchstart", e => {
                e.preventDefault();
                active = true;
            });
            stick.addEventListener("touchend", e => {
                e.preventDefault();
                active = false;
                callback({ x: 0, y: 0 });
                inner.style.transform = `translate(0px, 0px)`;
            });
            stick.addEventListener("touchmove", e => {
                if (!active) return;
                e.preventDefault();
                const touch = e.touches[0];
                let dx = touch.clientX - center.x;
                let dy = touch.clientY - center.y;
                const mag = Math.sqrt(dx * dx + dy * dy);
                if (mag > 50) {
                    dx = (dx / mag) * 50;
                    dy = (dy / mag) * 50;
                }
                callback({ x: dx / 50, y: dy / 50 });
                inner.style.transform = `translate(${dx}px, ${dy}px)`;
            });
            // Update center on window resize
            window.addEventListener("resize", () => {
                rect = stick.getBoundingClientRect();
                center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
            });
        }

        joystick("joystick-left", v => move = v);
        joystick("joystick-right", v => shoot = v);

        // Keyboard controls
        document.addEventListener('keydown', e => {
            if (e.key === 'w' || e.key === 'W') keys.w = true;
            if (e.key === 's' || e.key === 'S') keys.s = true;
            if (e.key === 'a' || e.key === 'A') keys.a = true;
            if (e.key === 'd' || e.key === 'D') keys.d = true;
            if (e.key === 'ArrowUp') keys.up = true;
            if (e.key === 'ArrowDown') keys.down = true;
            if (e.key === 'ArrowLeft') keys.left = true;
            if (e.key === 'ArrowRight') keys.right = true;
        });
        document.addEventListener('keyup', e => {
            if (e.key === 'w' || e.key === 'W') keys.w = false;
            if (e.key === 's' || e.key === 'S') keys.s = false;
            if (e.key === 'a' || e.key === 'A') keys.a = false;
            if (e.key === 'd' || e.key === 'D') keys.d = false;
            if (e.key === 'ArrowUp') keys.up = false;
            if (e.key === 'ArrowDown') keys.down = false;
            if (e.key === 'ArrowLeft') keys.left = false;
            if (e.key === 'ArrowRight') keys.right = false;
        });

        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
